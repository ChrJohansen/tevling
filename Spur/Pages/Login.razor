@page "/login"
@layout LoginLayout
@attribute [AllowAnonymous]

<PageTitle>Login</PageTitle>

<section class="spur-login">
    <h1 class="login-title">Spur</h1>
    <p class="login-subtitle">Accept the challenge</p>
    <div class="spur-logo"><img src="cogwheel.png" width="256" /></div>
    <form action="@StravaConfig.AuthorizeUri" method="get">
        <div class="login-button-container">Login with <button class="btn strava-login" type="submit">Strava</button>
        </div>
        <input type="hidden" name="client_id" value="@StravaConfig.ClientId" />
        <input type="hidden" name="redirect_uri" value="@RedirectUri" />
        <input type="hidden" name="response_type" value="@StravaConfig.ResponseType" />
        <input type="hidden" name="approval_prompt" value="@StravaConfig.ApprovalPrompt" />
        <input type="hidden" name="scope" value="@StravaConfig.Scope" />
    </form>
    <Copyright />
</section>

@inject StravaConfig StravaConfig
@code {
    [SupplyParameterFromQuery(Name = "returnUrl")]
    private string ReturnUrl { get; set; } = string.Empty;

    private string RedirectUri => $"{StravaConfig.RedirectUri}?returnUrl={Uri.EscapeDataString(ReturnUrl)}";
}
